<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link rel="shortcut icon" href="imagens/Caixa de presente com la√ßo.png" type="image/x-icon">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lista de Presentes - Casamento</title>
<style>
html,body{font-family:'Lato',sans-serif;margin:0;padding:0;background-color:#fff8f0;color:#404040}
header{background-color:#2e7d32;color:#fff;text-align:center;padding:2rem;font-size:2rem;font-weight:bold;border-bottom:3px solid #d4af37}
#catalogo{max-width:1200px;margin:2rem auto;padding:0 1rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}
.card{background:#fff;border-radius:12px;box-shadow:0 3px 6px rgba(0,0,0,.16);overflow:hidden;display:flex;flex-direction:column;transition:transform .3s;border-top:5px solid #d4af37}
.card:hover{transform:scale(1.03)}
.card img{width:100%;height:180px;object-fit:contain;background:#eee}
.card-content{padding:1rem;flex:1;display:flex;flex-direction:column;justify-content:space-between}
.card h3{font-size:1.2rem;margin-bottom:.5rem;color:#2e7d32}
.card p{font-size:.95rem;color:#555;margin-bottom:.8rem}
button{background-color:#2e7d32;border:none;color:#fff;padding:.75rem;border-radius:8px;cursor:pointer;font-size:1rem;transition:background .3s}
button:hover{background-color:#256028}
button[disabled]{background:#ccc;cursor:not-allowed}
input{padding:.5rem;width:80px;text-align:center;margin-bottom:.8rem;border-radius:5px;border:1px solid #ccc}
#confirmModal,#pixModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:flex;justify-content:center;align-items:center;visibility:hidden;opacity:0;transition:.2s}
#confirmModal.active,#pixModal.active{visibility:visible;opacity:1}
.modal{background:#fff;padding:1.5rem;border-radius:12px;max-width:480px;width:90%;text-align:center;box-shadow:0 5px 15px rgba(0,0,0,.3);border-top:5px solid #d4af37}
.modal h2{color:#2e7d32;margin-bottom:.8rem}
.modal p{margin:.4rem 0}
.modal .row{display:flex;gap:.5rem;justify-content:center;align-items:center;margin-top:.6rem}
.copy-btn{background:#d4af37;color:#fff;padding:.5rem 1rem;border-radius:8px;border:none;cursor:pointer}
.small{font-size:.95rem;color:#666;margin-top:.6rem}
.success{color:green}
.error{color:#e84155}
#compradorWrapper{max-width:480px;margin:1rem auto;text-align:center}
#nomeComprador{padding:.5rem;width:80%;border-radius:5px;border:1px solid #ccc;font-size:1rem}
.titulo-secao{grid-column:1/-1;font-size:1.5rem;font-weight:bold;color:#2e7d32;margin:1.5rem 0}

/* Loading */
#loading {
  text-align: center;
  font-size: 1rem;
  color: #2e7d32;
  font-weight: bold;
  display: none;
  margin-top: 1rem;
}
</style>
</head>
<body>
<header>üéÄ Lista de Presentes - Ch√° De Casa Nova</header>

<div id="compradorWrapper">
  <input type="text" id="nomeComprador" placeholder="Digite seu nome">
</div>

<div id="loading">üîÑ Atualizando lista...</div>

<main id="catalogo"></main>

<div id="confirmModal">
  <div class="modal">
    <h2>Confirmar presente</h2>
    <p id="conf-nome">Produto: ‚Äî</p>
    <p id="conf-qtd">Quantidade: ‚Äî</p>
    <p id="conf-unit">Valor unit√°rio: ‚Äî</p>
    <p id="conf-total" style="font-weight:700">Total: ‚Äî</p>
    <div class="small">Pix para pagamento:</div>
    <div style="margin:0.5rem 0;">
      <strong id="pix-key">21 971963818</strong>
    </div>
    <div class="row">
      <button class="copy-btn" onclick="copiarPix()">Copiar Pix</button>
      <button onclick="confirmarCompra()">Confirmar pagamento</button>
      <button onclick="fecharConfirm()">Cancelar</button>
    </div>
    <p id="conf-msg" class="small"></p>
  </div>
</div>

<div id="pixModal">
  <div class="modal">
    <h2>üéâ Obrigado pela sua contribui√ß√£o!</h2>
    <p>Envie o comprovante via WhatsApp (ou aguarde contato).</p>
    <p class="small">PIX: <strong>21 971963818</strong></p>
    <div class="row">
      <button onclick="fecharPix()">Fechar</button>
    </div>
  </div>
</div>

<script>
const PIX_KEY = "21 971963818";
const SCRIPT_URL = {
  GET: "https://script.google.com/macros/s/AKfycbzn99aofuKW2OkZzneTTEEiNHzRiptTVFhypk16FAWfWbWN5psdzVdD6zIoEracCpQafQ/exec",
  POST: "https://script.google.com/macros/s/AKfycbyapZ0u8gL8jO1fdPsZEKQWsbbH0K592FL4gB_qBlUzD5K6n60HBtT2dpNBLdFHoJNYaA/exec"
};

// =======================
// Lista de pre√ßos e imagens
// =======================
const precos = { "Sanduicheira":100, "Liquidificador":100, "Mixer":170, "Jogo de canecas":75,
"Jogo de pratos de porcelanato":100, "Utens√≠lios de silicone":50, "Boleira de vidro":50,
"Garrafa t√©rmica":55, "Escorredor de lou√ßa de parede":60, "Escorredores de inox":70,
"Talheres":60, "Potes herm√©ticos J1":90, "Potes herm√©ticos J2":105, "Jogo de copos de vidro":65,
"Jogo de tabuleiros":85, "Jogo de pirex":100, "Ralador":50, "T√°bua de inox":50, "Lixeiras":55,
"Suporte para papel higi√™nico":55, "Kits suporte de toalha":75, "Espelho":80, "Toalhas de rosto":50,
"Kit porta algod√£o, escova e cotonete + saboneteira":70, "Cortina":100, "Tapete":70,
"Capa de almofada":90, "Edredom":120, "2 jogos de len√ßol":70, "Travesseiros":75, "Cabeceira":60,
"Capa de colch√£o imperme√°vel":50, "Cesto de roupa":50, "Mope":50, "Ferro de passar roupa":110,
"T√°bua de passar roupa":100, "Varal de teto":65, "Varal de ch√£o":90 };

const imagensProdutos = { "Ar-condicionado":"imagens/ARCONDICIONADO.jpg", "Arm√°rio":"imagens/ARMARIO.jpg",
"Arm√°rio de cozinha":"imagens/ARMARIODECOZINHA.jpg", "Aspirador de p√≥":"imagens/ASPIRADORDEPO.jpg",
"Boleira de vidro":"imagens/BOLEIRADEVIDRO.jpg", "Capa de almofada":"imagens/CAPADEALMOFADA.jpg",
"Cabeceira":"imagens/CABECEIRA.jpg", "Capa de colch√£o imperme√°vel":"imagens/CAPADECOLCH√ÉOIMPERMEAVEL.jpg",
"Cesto de roupa":"imagens/SEXTODEROUPA.jpg", "Chaleira":"imagens/CHALEIRA.jpg",
"Colch√£o de casa D20":"imagens/COLCHAO.jpg", "Cortina":"imagens/CORTINA.jpg", "Edredom":"imagens/EDREDOM.jpg",
"Escorredores de inox":"imagens/ESCORREDORDEINOX.jpeg", "Escorredor de lou√ßa de parede":"imagens/ESCORREDORDELOU√áADEPARADE.jpg",
"Espelho":"imagens/ESPELHO.jpg", "Ferro de passar roupa":"imagens/FERRODEPASSAR.jpg", "Fog√£o":"imagens/FOGAO.jpg",
"Garrafa t√©rmica":"imagens/GARRAFATERMICA.jpg", "Geladeira":"imagens/GELADEIRA.jpg", "Jarra de suco":"imagens/JARRADESUCO.jpg",
"Jogo de canecas":"imagens/JOGODECANECAS.jpg", "Jogo de copos de vidro":"imagens/JOGODECOPOSDEVIDRO.jpg",
"2 jogos de len√ßol":"imagens/JOGODELEN√áOL.jpg", "Jogo de panela":"imagens/JOGODEPANELA.jpg",
"Jogo de pirex":"imagens/JOGODEPIREX.jpg", "Jogo de pratos de porcelanato":"imagens/JOGODEPRATOSPORCELANADO.jpg",
"Jogo de tabuleiros":"imagens/JOGODETABULEIROS.jpg",
"Kit porta algod√£o, escova e cotonete + saboneteira":"imagens/Kit porta algod√£o, escova e cotonete + saboneteira.jpg",
"Kits suporte de toalha":"imagens/KITSUPORTEDETOALHA.jpg", "Liquidificador":"imagens/LIQUIDIFICADOR.jpg",
"Lixeiras":"imagens/LIXEIRA.jpeg", "Micro-ondas":"imagens/MICROONDAS.jpg", "M√°quina de lavar":"imagens/MAQUINADELAVAR.jpeg",
"Mixer":"imagens/MIXER.jpg", "Mope":"imagens/MOPE.jpg", "Painel para TV":"imagens/PAINELPARATV.jpg",
"Panela de press√£o":"imagens/PANELADEPRESS√ÉO.jpg", "Potes herm√©ticos J1":"imagens/POTESHERMETICOSJ1.jpg",
"Potes herm√©ticos J2":"imagens/POTESHERMETICOSJ2.jpg", "Ralador":"imagens/RALADOR.jpg",
"Suporte para papel higi√™nico":"imagens/SUPORTEHIGIENICO.jpeg", "Sanduicheira":"imagens/SANDUUICHEIRA.jpg",
"Sapateira":"imagens/SAPATEIRA.jpg", "Sof√°":"imagens/SOF√Å.jpg", "Suporte higiene":"imagens/SUPORTEHIGIENE.jpg",
"Travesseiros":"imagens/TRAVESSEIRO.jpeg", "T√°bua de inox":"imagens/TABUADEINOX.jpg",
"T√°bua de passar roupa":"imagens/TABUADEPASSAR.jpg", "Talheres":"imagens/TALHERES.jpg",
"Tapete":"imagens/TAPETE.jpg", "Televis√£o":"imagens/TELEVIS√ÉO.jpg", "Toalhas de banho":"imagens/TOALHASDEBANHO.jpg",
"Toalhas de rosto":"imagens/TOALHASDEROSTO.jpg", "Utens√≠lios de silicone":"imagens/UTENCILIOSDESILICONE.jpg",
"Varal de ch√£o":"imagens/VARALCHAO.jpg", "Varal de teto":"imagens/VARALTETO.jpg" };

// =======================
// Itens e vales
// =======================
const itensNormais = Object.keys(precos);
const vales = [
  {nome:"Micro-ondas", limite:6},{nome:"Fog√£o", limite:10},{nome:"Arm√°rio de cozinha", limite:5},
  {nome:"Geladeira", limite:15},{nome:"Painel para TV", limite:2},{nome:"Sof√°", limite:10},
  {nome:"Televis√£o", limite:15},{nome:"Ar-condicionado", limite:10},{nome:"Arm√°rio", limite:10},
  {nome:"Colch√£o de casa D20", limite:3},{nome:"Sapateira", limite:3},{nome:"M√°quina de lavar", limite:10},
  {nome:"Aspirador de p√≥", limite:3}
];

// =======================
// Fun√ß√µes principais
// =======================
const catalogo = document.getElementById("catalogo");
const loading = document.getElementById("loading");
let currentSelection=null;

async function criarCards(){
  let id=1;
  const tituloItens=document.createElement('div');
  tituloItens.className='titulo-secao';
  tituloItens.textContent='üéÅ Itens Normais';
  catalogo.appendChild(tituloItens);
  for(const nome of itensNormais){
    const card=criarCard(nome,id,1);
    catalogo.appendChild(card);
    id++;
  }
  const tituloVales=document.createElement('div');
  tituloVales.className='titulo-secao';
  tituloVales.textContent='üéüÔ∏è Vales';
  catalogo.appendChild(tituloVales);
  for(const v of vales){
    const card=criarCard(v.nome,id,v.limite);
    catalogo.appendChild(card);
    id++;
  }
  await atualizarCards();
  setInterval(atualizarCards,10000);
}

function criarCard(nome,id,limite){
  const div=document.createElement("div");
  div.className="card";
  div.dataset.id=String(id);
  div.dataset.nome=nome;
  div.dataset.limite=String(limite);
  const imgSrc=imagensProdutos[nome]||`https://via.placeholder.com/300x180?text=${encodeURIComponent(nome)}`;
  const preco=precos[nome]||100;
  div.innerHTML=`
    <img src="${imgSrc}" alt="${nome}">
    <div class="card-content">
      <h3>${nome}</h3>
      <p id="disponivel-${id}">${limite>1?'Quantidade dispon√≠vel: '+limite:'Quantidade: 1'}</p>
      <input type="number" id="quantidade-${id}" value="1" min="1" max="${limite}" onchange="verificarQuantidade(this,${limite})">
      <p>Valor unit√°rio: R$ ${preco.toFixed(2).replace('.',',')}</p>
      <div style="display:flex;gap:.5rem;justify-content:center;align-items:center">
        <button onclick="abrirConfirm(this)">Escolher</button>
      </div>
    </div>
  `;
  return div;
}

function verificarQuantidade(input,limite){
  if(input.value<1) input.value=1;
  if(input.value>limite) input.value=limite;
}

async function atualizarCards(){
  try{
    loading.style.display="block";
    const res=await fetch(SCRIPT_URL.GET);
    const data=await res.json();
    if(data.dados){
      data.dados.forEach(item=>{
        const cards=document.querySelectorAll(`.card[data-nome="${item.nome}"]`);
        cards.forEach(card=>{
          const btn=card.querySelector('button');
          const limite=parseInt(card.dataset.limite);
          const totalComprado=parseInt(item.quantidade);
          const restante=limite-totalComprado;
          const pDisponivel=card.querySelector(`#disponivel-${card.dataset.id}`);
          if(pDisponivel)pDisponivel.textContent=restante>0?'Quantidade dispon√≠vel: '+restante:'Esgotado';
          if(limite>0&&totalComprado>=limite){
            btn.textContent='Escolhido';
            btn.disabled=true;
            card.style.opacity=0.6;
            const input=card.querySelector('input');
            if(input)input.value=limite;
          }else{
            btn.textContent='Escolher';
            btn.disabled=false;
            card.style.opacity=1;
          }
        });
      });
    }
  }catch(err){console.error('Erro ao atualizar cards',err);}
  finally{loading.style.display="none";}
}

const confirmModal=document.getElementById('confirmModal');
const pixModal=document.getElementById('pixModal');

async function abrirConfirm(btn){
  const card=btn.closest('.card');
  const id=card.dataset.id;
  const nome=card.dataset.nome;
  const limite=parseInt(card.dataset.limite);
  let quantidade=parseInt(document.getElementById(`quantidade-${id}`).value)||1;
  if(quantidade<1){alert("Informe uma quantidade v√°lida");return;}
  const comprador=document.getElementById("nomeComprador").value.trim();
  if(!comprador){alert("Por favor, digite seu nome antes de escolher o presente.");return;}
  let totalComprado=0;
  try{
    const res=await fetch(SCRIPT_URL.GET);
    const data=await res.json();
    if(data.dados){
      totalComprado=data.dados.filter(item=>item.nome===nome).reduce((acc,item)=>acc+Number(item.quantidade),0);
    }
  }catch(err){console.error(err);}
  const restante=limite-totalComprado;
  if(restante<=0){alert("Quantidade esgotada");return;}
  if(quantidade>restante){alert("Quantidade maior que o limite dispon√≠vel");quantidade=restante;}
  currentSelection={id:String(id),nome,limite,quantidade,comprador};
  const preco=precos[nome]||100;
  document.getElementById('conf-nome').textContent=`Produto: ${nome}`;
  document.getElementById('conf-qtd').textContent=`Quantidade: ${quantidade}`;
  document.getElementById('conf-unit').textContent=`Valor unit√°rio: R$ ${preco.toFixed(2).replace('.',',')}`;
  document.getElementById('conf-total').textContent=`Total: R$ ${(preco*quantidade).toFixed(2).replace('.',',')}`;
  confirmModal.classList.add('active');
}

function fecharConfirm(){confirmModal.classList.remove('active');}
function fecharPix(){pixModal.classList.remove('active');}

async function confirmarCompra(){
  if(!currentSelection)return;
  const {nome,quantidade,comprador}=currentSelection;
  const confMsg=document.getElementById('conf-msg');
  confMsg.textContent="Enviando...";
  try{
    await fetch(SCRIPT_URL.POST,{
      method:"POST",
      mode:"no-cors",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({nome,quantidade,comprador,totalComprado:0,status:"pendente"})
    });
    confMsg.textContent="‚úÖ Enviado com sucesso!";
    
    // Atualiza os cards imediatamente antes de mostrar o modal do PIX
    await atualizarCards();

    setTimeout(()=>{
      confirmModal.classList.remove('active');
      pixModal.classList.add('active');
    },200); // um delay pequeno s√≥ para anima√ß√£o do modal
  }catch(err){
    confMsg.textContent="‚ùå Erro: "+err.message;
  }
}

function copiarPix(){
  navigator.clipboard.writeText(PIX_KEY).then(()=>alert("Pix copiado!"));
}

window.onload=criarCards;
</script>
</body>
</html>
